<!DOCTYPE html>
<html>
<head>
    <title>RecPT Test</title>
    <style>
        .message-container {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .user-message {
            background-color: #e7f3fe;
            padding: 5px 10px;
            border-radius: 5px;
        }

        .system-message {
            background-color: #f5f5f5;
            padding: 5px 10px;
            border-radius: 5px;
        }

        .assistant-message {
            background-color: #d3d3d3;
            padding: 5px 10px;
            border-radius: 5px;
            white-space: pre-wrap;
        }

        .form-container {
            display: flex;
            gap: 10px;
        }
    </style>
</head>
<body>
<div class="message-container" id="messageContainer"></div>
<form id="messageForm" class="form-container">
    <input type="text" id="message" name="message" required>
    <button type="submit">Send</button>
</form>
<button id="editButton" type="button">Edit</button>
<button id="saveButton" type="button">Save</button>
<button id="refreshButton" type="button">Refresh</button>

<script>
    const messageContainer = document.getElementById('messageContainer');
    const form = document.getElementById('messageForm');
    const messageInput = document.getElementById('message');
    const editButton = document.getElementById('editButton');
    const saveButton = document.getElementById('saveButton');
    const refreshButton = document.getElementById('refreshButton');
    let conversation = [];

    form.addEventListener('submit', async (e) => {
        e.preventDefault();

        const message = messageInput.value;
        messageInput.value = '';

        addMessage('user', message);

        const response = await sendMessage(message);
        addMessage('assistant', response);
    });

    editButton.addEventListener('click', async () => {
        const message = messageInput.value;
        messageInput.value = '';
        editMessage(message);
        const response = await sendMessage(message);
        addMessage('assistant', response);
    });

    saveButton.addEventListener('click', async () => {
        const response = await saveConversation();
        addMessage('assistant', response);
    });

    refreshButton.addEventListener('click', async () => {
        const response = await refreshConversation();
        responseDiv.textContent = response
    });

    function addMessage(role, content) {
        const messageDiv = document.createElement('div');
        messageDiv.classList.add(role.toLowerCase() + '-message');

        if (role === 'assistant') {
            messageDiv.classList.add('assistant-message');
        }

        messageDiv.textContent = content;

        messageContainer.appendChild(messageDiv);
    }

    async function sendMessage(message) {
        const response = await fetch('/api/chat/send', {
            method: 'post',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(message)
        });

        const data = await response.json();
        return data.data;
    }

    async function editMessage(content) {
        const response = await fetch('/api/chat/edit', {
            method: 'post',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(content)
        });

        const data = await response.json();
        return data.data;
    }

    async function refreshConversation() {
        const response = await fetch('/api/chat/refresh', {
            method: 'post',
            headers: {
                'Content-Type': 'application/json'
            }
        });
        return response;
    }

    async function saveConversation() {
        const response = await fetch('/api/chat/save', {
            method: 'post',
            headers: {
                'Content-Type': 'application/json'
            }
        });

        const data = await response.json();
        const responseMessage = data.data;

        const lines = responseMessage.split('\n');

        // messageContainer.innerHTML = '';

        // lines.forEach((line) => {
        //     const messageDiv = document.createElement('div');
        //     messageDiv.classList.add('system-message');
        //     messageDiv.textContent = line;
        //
        //     messageContainer.appendChild(messageDiv);
        // });

        return responseMessage;
    }

</script>
</body>
</html>

<!--<!DOCTYPE html>-->
<!--<html>-->
<!--<head>-->
<!--    <title>Chat App</title>-->
<!--</head>-->
<!--<body>-->
<!--<form id="messageForm">-->
<!--    <label for="message">Enter your message:</label>-->
<!--    <input type="text" id="message" name="message" required>-->
<!--    <button type="submit">Send</button>-->
<!--    <button id="editButton" type="button">Edit</button>-->
<!--    <button id="saveButton" type="button">Save</button>-->
<!--    <button id="refreshButton" type="button">Refresh</button>-->
<!--</form>-->
<!--<div id="response"></div>-->

<!--<script>-->
<!--    const form = document.getElementById('messageForm');-->
<!--    const messageInput = document.getElementById('message');-->
<!--    const responseDiv = document.getElementById('response');-->
<!--    const editButton = document.getElementById('editButton');-->
<!--    const saveButton = document.getElementById('saveButton');-->
<!--    const refreshButton = document.getElementById('refreshButton');-->
<!--    let conversation = [];-->

<!--    form.addEventListener('submit', async (e) => {-->
<!--        e.preventDefault();-->

<!--        const message = messageInput.value;-->
<!--        messageInput.value = '';-->

<!--        const response = await sendMessage(message);-->
<!--        responseDiv.textContent = response;-->
<!--    });-->

<!--    editButton.addEventListener('click', () => {-->
<!--        const message = messageInput.value;-->
<!--        messageInput.value = '';-->
<!--        editMessage(message);-->
<!--    })-->
<!--    ;-->

<!--    saveButton.addEventListener('click', async () => {-->
<!--        const response = await saveConversation();-->
<!--        responseDiv.textContent = response;-->
<!--    });-->

<!--    refreshButton.addEventListener('click', async () => {-->
<!--        const response = await refreshConversation();-->
<!--        responseDiv.textContent = response;-->
<!--    });-->

<!--    async function sendMessage(message) {-->
<!--        conversation.push({role: 'USER', content: message});-->

<!--        const response = await fetch('/api/chat/send', {-->
<!--            method: 'post',-->
<!--            headers: {-->
<!--                'Content-Type': 'application/json'-->
<!--            },-->
<!--            body: JSON.stringify(message)-->
<!--        });-->

<!--        const data = await response.json();-->
<!--        conversation.push({role: 'SYSTEM', content: data.data});-->

<!--        return data.data;-->
<!--    }-->

<!--    async function editMessage(content) {-->
<!--        const response = await fetch('/api/chat/edit', {-->
<!--            method: 'post',-->
<!--            headers: {-->
<!--                'Content-Type': 'application/json'-->
<!--            },-->
<!--            body: JSON.stringify(content)-->
<!--        });-->

<!--        const data = await response.json();-->
<!--        conversation.push({role: 'USER', content: '[수정] ' + content});-->

<!--        responseDiv.textContent = data.data;-->
<!--    }-->

<!--    async function saveConversation() {-->
<!--        const response = await fetch('/api/chat/save', {-->
<!--            method: 'post',-->
<!--            headers: {-->
<!--                'Content-Type': 'application/json'-->
<!--            }-->
<!--        });-->

<!--        const data = await response.json();-->
<!--        conversation.push({role: 'USER', content: '[저장]'});-->

<!--        return data.data;-->
<!--    }-->

<!--    async function refreshConversation() {-->
<!--        const response = await fetch('/api/chat/refresh', {-->
<!--            method: 'post',-->
<!--            headers: {-->
<!--                'Content-Type': 'application/json'-->
<!--            }-->
<!--        });-->

<!--        const data = await response.json();-->
<!--        conversation = [];-->

<!--        return data.data;-->
<!--    }-->
<!--</script>-->
<!--</body>-->
<!--</html>-->


<!--<!DOCTYPE html>-->
<!--<html>-->
<!--<head>-->
<!--    <title>Chat App</title>-->
<!--</head>-->
<!--<body>-->
<!--<h1>Chat App</h1>-->
<!--<form id="messageForm">-->
<!--    <label for="message">Enter your message:</label>-->
<!--    <input type="text" id="message" name="message" required>-->
<!--    <button type="submit">Send</button>-->
<!--</form>-->
<!--<div id="response"></div>-->

<!--<script>-->
<!--    const form = document.getElementById('messageForm');-->
<!--    const messageInput = document.getElementById('message');-->
<!--    const responseDiv = document.getElementById('response');-->

<!--    form.addEventListener('submit', async (e) => {-->
<!--        e.preventDefault();-->

<!--        const message = messageInput.value;-->
<!--        messageInput.value = '';-->

<!--        const response = await sendMessage(message);-->
<!--        responseDiv.textContent = response;-->
<!--    });-->

<!--    async function sendMessage(message) {-->
<!--        const response = await fetch('/api/chat/send', {-->
<!--            method: 'post',-->
<!--            headers: {-->
<!--                'Content-Type': 'application/json'-->
<!--            },-->
<!--            body: JSON.stringify(message)-->
<!--        });-->

<!--        const data = await response.json();-->
<!--        return data.data;-->
<!--    }-->
<!--</script>-->
<!--</body>-->
<!--</html>-->



